<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    <script src="chart.js"></script>
    <script src="ebay_api.js"></script>
    <link rel="stylesheet" type="text/css" href="chart.css"/>
</head>
<body>
<div id="canvas"></div>
<button onclick="nextEbayRequest()">Fetch more</button>
<script>

    var format = d3.time.format("%Y-%m-%dT%H:%M:%S.%LZ");
    var x = {
        label: "Listing Begin",
        scale: Chart.scaleType.TIME,
        fun: function (d) {
            var dateStr = d.listingInfo[0].startTime[0];
            return format.parse(dateStr);
        }
    };
    var y = {
        label: "Current Price (USD)",
        scale: Chart.scaleType.LINEAR,
        fun: function (d) {
            return d.sellingStatus[0].currentPrice[0].__value__;
        }
    };
    var chart = new Chart(x, y);

    var allItems = [];
    function populateChart(data) {
        var newItems = data.findItemsAdvancedResponse[0].searchResult[0].item || [];
        allItems = allItems.concat(newItems);
        chart.populate(allItems);
    }

    var ebay = new Ebay();
    var requestCount = 0;
    function nextEbayRequest() {
        requestCount = requestCount + 1;
        var ebayParams = {
            page: requestCount
        };
        ebay.call(populateChart, ebayParams);
    }

</script>
</body>
</html>